{
  "minerType": {
    "name": "Defensio",
    "description": "(Midnight Fork), Needs Python In Cellhasher Settings to install.",
    "installScript": "import os, time, subprocess, tempfile\r\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\r\n\r\nADB = os.environ.get(\"adb_path\", \"adb\")\r\ndevices = os.environ.get(\"devices\", \"\").split()\r\n\r\n# --- Defensio Miner installer & initializer ---\r\ninstall_script_template = r'''#!/data/data/com.termux/files/usr/bin/bash\r\nset -e\r\nexport DEBIAN_FRONTEND=noninteractive\r\nexport TERMUX_PKG_NO_PROMPT=1\r\n\r\necho \"[*] Preparing environment...\"\r\npkg update -y || true\r\npkg upgrade -y || true\r\npkg install -y wget tar git nodejs -y || true\r\n\r\necho \"[*] Disabling nvm auto-load...\"\r\nsed -i '/nvm.sh/d' ~/.bashrc 2>/dev/null || true\r\nsed -i '/NVM_DIR/d' ~/.bashrc 2>/dev/null || true\r\n\r\necho \"[*] Creating working directory...\"\r\nmkdir -p ~/defensio\r\ncd ~/defensio\r\n\r\necho \"[*] Cloning DefensioMiner repository...\"\r\nif [ -d \"DefensioMiner\" ]; then\r\n  rm -rf DefensioMiner\r\nfi\r\ngit clone https://github.com/lukewrightmain/DefensioMiner.git\r\ncd DefensioMiner\r\n\r\necho \"[*] Downloading precompiled solver binary...\"\r\nwget -q --show-progress https://github.com/lukewrightmain/defensiominer/releases/download/RC1/solver-android-arm64.tar.gz\r\n\r\necho \"[*] Extracting solver binary...\"\r\nmkdir -p solver/target/release\r\ntar -xzf solver-android-arm64.tar.gz -C solver/target/release/\r\nchmod +x solver/target/release/solve\r\nrm solver-android-arm64.tar.gz\r\n\r\necho \"[*] Installing Node.js dependencies...\"\r\nnpm install\r\n\r\necho \"[*] Creating default settings.json...\"\r\ncat > ~/defensio/settings.json << 'EOF'\r\n{\r\n  \"wallet_count\": 10,\r\n  \"worker_threads\": 8,\r\n  \"batch_size\": 5,\r\n  \"wallet_range_from\": 1,\r\n  \"wallet_range_to\": 10\r\n}\r\nEOF\r\n\r\nif [ -f ~/defensio/settings.json ]; then\r\n  echo \"[OK] Initial setup complete! settings.json created.\"\r\nelse\r\n  echo \"[WARN] settings.json not found; setup may have failed.\"\r\nfi\r\n\r\necho \"[*] DefensioMiner installation complete!\"\r\n'''\r\n\r\ndef install_on_device(device_id):\r\n    try:\r\n        print(f\"[{device_id}] Starting Defensio install...\")\r\n        subprocess.run(f\"{ADB} -s {device_id} shell am force-stop com.termux\", shell=True)\r\n        time.sleep(1)\r\n        \r\n        # Generate installer script\r\n        script_content = install_script_template\r\n        \r\n        # Force Unix line endings\r\n        with tempfile.NamedTemporaryFile(\"w\", encoding=\"utf-8\", delete=False, suffix=\".sh\", newline='\\n') as f:\r\n            f.write(script_content)\r\n            local_script = f.name\r\n        \r\n        remote_path = \"/data/local/tmp/defensio_install.sh\"\r\n        subprocess.run(f'{ADB} -s {device_id} push \"{local_script}\" \"{remote_path}\"', shell=True, check=True)\r\n        subprocess.run(f\"{ADB} -s {device_id} shell chmod 755 {remote_path}\", shell=True, check=True)\r\n        \r\n        print(f\"[{device_id}] Launching Termux...\")\r\n        subprocess.run(f\"{ADB} -s {device_id} shell am start -n com.termux/com.termux.app.TermuxActivity\", shell=True)\r\n        time.sleep(8)\r\n        \r\n        print(f\"[{device_id}] Executing installer...\")\r\n        typed = f\"bash%s{remote_path}\"\r\n        subprocess.run(f'{ADB} -s {device_id} shell input text \"{typed}\"', shell=True)\r\n        time.sleep(1)\r\n        subprocess.run(f\"{ADB} -s {device_id} shell input keyevent 66\", shell=True)\r\n        \r\n        # Installation takes time (npm install, etc.)\r\n        time.sleep(120)\r\n        \r\n        print(f\"[{device_id}] ‚úÖ Defensio miner installed and initialized.\")\r\n        os.unlink(local_script)\r\n        return f\"[{device_id}] Success\"\r\n        \r\n    except Exception as e:\r\n        print(f\"[{device_id}] ‚ùå Error: {e}\")\r\n        return f\"[{device_id}] Error: {e}\"\r\n\r\nif not devices:\r\n    print(\"No devices in $devices\")\r\nelse:\r\n    print(\"=== Starting Defensio Miner Installation & Initialization (Parallel) ===\")\r\n    with ThreadPoolExecutor(max_workers=max(1, len(devices))) as executor:\r\n        futures = {executor.submit(install_on_device, d): d for d in devices}\r\n        for f in as_completed(futures):\r\n            print(f.result())\r\n    print(\"‚úÖ All installation commands sent.\")",
    "runScript": "import os\r\nimport time\r\nimport subprocess\r\nimport tempfile\r\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\r\n\r\n# Environment variables from UI\r\nADB = os.environ.get(\"adb_path\", \"adb\")\r\ndevices = os.environ.get(\"devices\", \"\").split()\r\nthreads = os.environ.get(\"threads\", \"8\")\r\nadditional_flags = os.environ.get(\"additional_flags\", \"10,5\")\r\n\r\n# Parse additional_flags: \"wallet_count,batch_size\"\r\ntry:\r\n    parts = additional_flags.split(\",\")\r\n    wallet_count = parts[0].strip() if len(parts) > 0 else \"10\"\r\n    batch_size = parts[1].strip() if len(parts) > 1 else \"5\"\r\nexcept:\r\n    wallet_count = \"10\"\r\n    batch_size = \"5\"\r\n\r\ndef adb_cmd(cmd):\r\n    \"\"\"Execute ADB command without showing console window\"\"\"\r\n    flags = 0x08000000 if os.name == 'nt' else 0\r\n    return subprocess.run(\r\n        cmd, \r\n        shell=True, \r\n        capture_output=True, \r\n        text=True, \r\n        creationflags=flags\r\n    )\r\n\r\ndef type_in_termux(device_id: str, text: str, press_enter=True, pause=0.35):\r\n    \"\"\"Type text into Termux using ADB input\"\"\"\r\n    escaped = text.replace(\" \", \"%s\")\r\n    adb_cmd(f'{ADB} -s {device_id} shell input text \"{escaped}\"')\r\n    if press_enter:\r\n        time.sleep(0.25)\r\n        adb_cmd(f\"{ADB} -s {device_id} shell input keyevent 66\")\r\n    time.sleep(pause)\r\n\r\ndef create_runner_script(device_id: str):\r\n    \"\"\"Create runner script and push to /data/local/tmp/\"\"\"\r\n    \r\n    runner_script = f'''#!/data/data/com.termux/files/usr/bin/bash\r\nset -e\r\n\r\necho \"==========================================\"\r\necho \"Defensio Miner - Starting\"\r\necho \"==========================================\"\r\necho \"Wallet Count: {wallet_count}\"\r\necho \"Batch Size: {batch_size}\"\r\necho \"Threads: {threads}\"\r\necho \"==========================================\"\r\n\r\ncd ~/defensio/DefensioMiner\r\n\r\necho \"[1/3] Generating {wallet_count} wallets...\"\r\nnpm run generate -- --count {wallet_count}\r\n\r\necho \"[2/3] Registering {wallet_count} wallets...\"\r\nnpm run register -- --from 1 --to {wallet_count}\r\n\r\necho \"[3/3] Starting miner...\"\r\nexport ASHMAIZE_THREADS={threads}\r\nnpm run start -- --from 1 --to {wallet_count} --batch {batch_size}\r\n'''\r\n    \r\n    with tempfile.NamedTemporaryFile(\"w\", encoding=\"utf-8\", delete=False, suffix=\".sh\", newline='\\n') as f:\r\n        f.write(runner_script)\r\n        local_script = f.name\r\n    \r\n    # Push to /data/local/tmp/ (like Nocturne does)\r\n    remote_path = \"/data/local/tmp/defensio_runner.sh\"\r\n    adb_cmd(f'{ADB} -s {device_id} push \"{local_script}\" \"{remote_path}\"')\r\n    adb_cmd(f\"{ADB} -s {device_id} shell chmod 755 {remote_path}\")\r\n    \r\n    os.unlink(local_script)\r\n    \r\n    return remote_path  # Return the full path\r\n\r\ndef run_defensio_on_device(device_id: str):\r\n    \"\"\"Start Defensio miner on a single device\"\"\"\r\n    try:\r\n        print(f\"[{device_id}] === Starting Defensio Miner ===\")\r\n        \r\n        # Step 1: Kill old processes and restart Termux\r\n        print(f\"[{device_id}] Stopping old tasks...\")\r\n        adb_cmd(f'{ADB} -s {device_id} shell \"pkill -f node 2>/dev/null || true\"')\r\n        adb_cmd(f'{ADB} -s {device_id} shell \"pkill -f npm 2>/dev/null || true\"')\r\n        adb_cmd(f'{ADB} -s {device_id} shell \"pkill -f solve 2>/dev/null || true\"')\r\n        \r\n        print(f\"[{device_id}] Restarting Termux...\")\r\n        adb_cmd(f\"{ADB} -s {device_id} shell am force-stop com.termux\")\r\n        time.sleep(2)\r\n        \r\n        adb_cmd(f\"{ADB} -s {device_id} shell am start -n com.termux/com.termux.app.TermuxActivity\")\r\n        time.sleep(8)\r\n        \r\n        # Step 2: Push runner script\r\n        print(f\"[{device_id}] Pushing runner script...\")\r\n        runner_path = create_runner_script(device_id)\r\n        time.sleep(1)\r\n        \r\n        # Step 3: Navigate to defensio directory\r\n        print(f\"[{device_id}] Navigating to ~/defensio...\")\r\n        type_in_termux(device_id, \"cd ~/defensio\", pause=1.0)\r\n        \r\n        # Step 4: Run script with full path (EXACTLY like Nocturne)\r\n        print(f\"[{device_id}] Starting miner script...\")\r\n        type_in_termux(device_id, f\"bash {runner_path}\", pause=2.0)\r\n        \r\n        # Step 5: Keep awake\r\n        adb_cmd(f\"{ADB} -s {device_id} shell svc power stayon true\")\r\n        \r\n        print(f\"[{device_id}] ‚úÖ Miner launched! (Generating {wallet_count} wallets...)\")\r\n        return f\"[{device_id}] Success\"\r\n        \r\n    except Exception as e:\r\n        print(f\"[{device_id}] ‚ùå ERROR: {e}\")\r\n        import traceback\r\n        traceback.print_exc()\r\n        return f\"[{device_id}] Error: {e}\"\r\n\r\ndef main():\r\n    print(\"\\n\" + \"=\" * 70)\r\n    print(\"DEFENSIO MINER - RUN SCRIPT\")\r\n    print(\"=\" * 70)\r\n    \r\n    if not devices:\r\n        print(\"‚ùå ERROR: No devices found in environment!\")\r\n        print(f\"   ADB path: {ADB}\")\r\n        print(f\"   Devices env: '{os.environ.get('devices', 'NOT SET')}'\")\r\n        return\r\n    \r\n    print(f\"ADB Path: {ADB}\")\r\n    print(f\"Devices: {devices}\")\r\n    print(f\"Wallet Count: {wallet_count}\")\r\n    print(f\"Batch Size: {batch_size}\")\r\n    print(f\"Threads: {threads}\")\r\n    print(\"=\" * 70)\r\n    \r\n    with ThreadPoolExecutor(max_workers=max(1, len(devices))) as executor:\r\n        futures = {executor.submit(run_defensio_on_device, d): d for d in devices}\r\n        for future in as_completed(futures):\r\n            result = future.result()\r\n            print(result)\r\n    \r\n    print(\"\\n‚úÖ Deployment complete! Check Termux screens.\")\r\n    print(\"=\" * 70 + \"\\n\")\r\n\r\nif __name__ == \"__main__\":\r\n    main()",
    "stopScript": "# defensio_stop.py\r\n# Stop Defensio miner by killing Termux (and try to kill node/npm/solve processes if they escaped).\r\n\r\nimport os, subprocess, concurrent.futures\r\n\r\nADB     = os.environ.get(\"adb_path\", \"adb\")\r\ndevices = os.environ.get(\"devices\", \"\").split()\r\n\r\ndef adb_cmd(cmd):\r\n    \"\"\"Execute ADB command without showing console window\"\"\"\r\n    flags = 0x08000000 if os.name == 'nt' else 0  # CREATE_NO_WINDOW on Windows\r\n    return subprocess.run(\r\n        cmd, \r\n        shell=True, \r\n        capture_output=True, \r\n        text=True,\r\n        creationflags=flags\r\n    )\r\n\r\ndef stop_on(device_id: str):\r\n    try:\r\n        # Kill any stray Defensio miner processes (if running outside Termux session)\r\n        adb_cmd(f'{ADB} -s {device_id} shell \"pkill -f node 2>/dev/null || true\"')\r\n        adb_cmd(f'{ADB} -s {device_id} shell \"pkill -f npm 2>/dev/null || true\"')\r\n        adb_cmd(f'{ADB} -s {device_id} shell \"pkill -f solve 2>/dev/null || true\"')\r\n        adb_cmd(f'{ADB} -s {device_id} shell \"pkill -f defensio 2>/dev/null || true\"')\r\n\r\n        # Force-stop Termux (kills active foreground miner session)\r\n        adb_cmd(f\"{ADB} -s {device_id} shell am force-stop com.termux\")\r\n\r\n        print(f\"[{device_id}] üõë Defensio miner stopped successfully.\")\r\n    except Exception as e:\r\n        print(f\"[{device_id}] ‚ùå Error stopping miner: {e}\")\r\n\r\ndef main():\r\n    if not devices:\r\n        print(\"No devices in $devices\")\r\n        return\r\n\r\n    print(\"=== Stopping Defensio Miner on All Devices ===\")\r\n\r\n    with concurrent.futures.ThreadPoolExecutor(max_workers=max(1, len(devices))) as ex:\r\n        futs = [ex.submit(stop_on, d) for d in devices]\r\n        for f in concurrent.futures.as_completed(futs):\r\n            f.result()\r\n\r\n    print(\"‚úÖ All stop commands sent.\")\r\n\r\nif __name__ == \"__main__\":\r\n    main()",
    "uninstallScript": "",
    "installTermux": false,
    "installScriptLanguage": "Python",
    "runScriptLanguage": "Python",
    "stopScriptLanguage": "Python",
    "uninstallScriptLanguage": "Lua",
    "id": "a6045820-ecbf-4ee5-b4bd-1fb957f5d581"
  },
  "timestamp": "2025-11-20T02:28:41.706Z",
  "version": "1.0.0"
}